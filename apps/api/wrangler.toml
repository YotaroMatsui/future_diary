name = "future-diary-api"
main = "src/index.ts"
compatibility_date = "2026-02-07"
workers_dev = true

[vars]
OPENAI_BASE_URL = "https://api.openai.com/v1"
OPENAI_MODEL = "gpt-4o-mini"
AI_EMBEDDING_MODEL = "@cf/baai/bge-m3"

[ai]
binding = "AI"

[[d1_databases]]
binding = "DB"
database_name = "future-diary"
database_id = "fddf415b-ab33-405d-9845-e34375371822"
migrations_dir = "../../packages/db/src/migrations"

[[vectorize]]
binding = "VECTOR_INDEX"
index_name = "future-diary-index"

[[queues.producers]]
binding = "GENERATION_QUEUE"
queue = "future-diary-generation"

[[queues.consumers]]
queue = "future-diary-generation"
max_batch_size = 10
max_batch_timeout = 5

[durable_objects]
bindings = [{ name = "GENERATION_LOCK", class_name = "DraftGenerationLock" }]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["DraftGenerationLock"]
