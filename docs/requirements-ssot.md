# requirements.md — 未来日記

## 1. 概要

**未来日記**は、ユーザがこれまで書いてきた日記（過去の書記）を参照し、**その日の「当日の日記（未来の日記）」を自動生成**するプロダクトである。  
ユーザは生成された未来日記に対して、**その日に実際に起きた出来事や実際に行ったことを加筆・修正**し、最終的な日記として確定できる。

### 1.1 価値提案

- 「白紙の日記」を埋める心理的コストを下げ、日記の継続を支援する
- 過去の自分らしい筆致を再現することで、書き始めの抵抗感を下げる
- “予測の物語” → “実際の記録” へ編集するプロセスにより、内省や行動の振り返りを促す
  - ※科学的に、書くこと（表出・振り返り・再解釈）はストレス低減や感情整理に寄与しうるため、体験設計で「自己効力感」「自己受容」を損ねないガードレールを持つ（後述）

---

## 2. 用語定義

- **未来日記**：当日、ユーザが初めてその日の日記画面を開いたタイミングで自動生成される、その日の“仮”の日記（ドラフト）。
- **確定日記**：ユーザが未来日記を加筆修正し、保存・確定した最終版。
- **過去の書記**：ユーザが過去に入力した日記本文・タイトル・タグ・気分等（保存されている履歴）。
- **筆致再現**：語彙、語尾、文体、句読点、改行、テンポ、よく使う言い回し等の傾向を、ユーザ単位で再現すること。

---

## 3. プロダクトゴール / 非ゴール

### 3.1 ゴール

- 当日初回オープン時に、未来日記が自動生成されている
- 過去の書記を参照し、ユーザの筆致・文章の癖が“それらしく”反映されている
- ユーザがその日の事実に合わせて、未来日記を自然に編集・追記できる
- 日記の継続率・記入量・主観的満足度の向上

### 3.2 非ゴール（初期）

- 外部情報（天気/ニュース/他サービスの予定）を勝手に取り込んで断定的に予測すること
- “未来を当てる”こと自体の精度競争（予言サービス化）
- ユーザの意思に反してデータを学習・共有すること

---

## 4. 想定ユーザ / 主要ユースケース

### 4.1 想定ユーザ

- 日記を続けたいが、書き始めが重い人
- 文章がまとまらず、下書きがあると助かる人
- 自分の文体で書かれた“きっかけ”がほしい人

### 4.2 代表的な利用シナリオ

1. 朝、アプリを開く → 未来日記が自動で生成されている → そのまま一日を始める
2. 夜、未来日記を読み返す → 実際に起きたことを加筆修正 → 確定保存
3. 書く気力がない日でも、未来日記が入口になって短い追記だけで終えられる

---

## 5. 体験設計の原則（ウェルビーイング配慮）

- 未来日記は「断定」ではなく「仮説の物語」として扱う
  - 表示上も、**“未来日記（下書き）”**であることが分かるラベル/説明を置く
- ユーザの自己効力感を守る
  - “できなかった”を責める文体・煽りを避ける（自己批判を促進しない）
- 小さな達成や感謝を拾いやすい導線を用意（任意）
  - 例：編集時に「良かったこと1つ」「助かったこと1つ」などの軽い補助（強制しない）
- ネガティブ内容が多いユーザには、過度な増幅を避ける安全設計
  - 例：同じ悲観表現の反復を減らし、事実/感情/気づきのバランスを整える提案

---

## 6. 機能要件

### 6.1 未来日記の自動生成（コア）

#### 6.1.1 生成トリガ

- **当日の日記画面を、その日初めて開いたタイミング**で自動生成を実行する
- 当日の判定はユーザのタイムゾーンに従う（例：Asia/Tokyo）
- 生成結果は“その日1回”を原則として保存し、同日に何度開いても同じドラフトを表示する
  - 例外：ユーザが明示的に再生成を実行した場合（任意機能）

#### 6.1.2 参照データ（入力）

- ユーザの過去の書記（本文、タイトル、タグ、気分、時刻、曜日など）を参照可能
- 最低限：過去本文のみでも動作する
- ユーザが「参照してよい期間/範囲」を設定できる（任意、プライバシー配慮）

#### 6.1.3 生成内容（出力）

- 生成される未来日記は以下を満たす：
  - 過去の書記の話題傾向・生活リズム・言い回しを反映
  - ただし、**外部事実を断定**しない（例：「今日は雨が降った」等は避ける）
  - ユーザが編集しやすいよう、過度に長すぎない（目安：数段落〜）
  - タイトルがある場合、タイトルもユーザの癖を反映して提案可能（任意）

#### 6.1.4 表示要件

- 当日ページを開いたら、未来日記（下書き）がすでに本文欄に入っている
- “自動生成”であること、後から自由に修正できることが分かるUI文言を表示

---

### 6.2 加筆・修正（確定まで）

#### 6.2.1 編集

- ユーザは未来日記本文を自由に編集できる（追記・削除・置換）
- 編集はオートセーブまたは明示保存のいずれかで失われない

#### 6.2.2 確定

- ユーザが「確定」操作を行うと、その日の確定日記として保存される
- 確定後も再編集は可能（方針次第）
  - 例：確定＝スナップショットを残し、最新版も更新できる

#### 6.2.3 変更履歴（推奨）

- 未来日記（生成ドラフト）と、ユーザ編集後（確定版）の差分を内部的に保持する（監査/品質改善/ユーザ体験向上のため）
- UI上に差分表示は任意（初期は保持のみでも可）

---

### 6.3 過去の日記閲覧

- カレンダー/リストで日記を閲覧できる
- 当日ページは「未来日記（下書き）／確定済み」を区別して表示

---

### 6.4 パーソナライズ（筆致再現）

#### 6.4.1 筆致再現の要素

- 語尾（です・ます/だ・である/くだけた口語 等）
- 句読点・改行の癖
- よく使う接続詞、感嘆、絵文字、括弧の使い方
- 文の長さの分布、テンポ
- 頻出テーマ（仕事/運動/食事/人間関係 等）

#### 6.4.2 再現度の調整（任意）

- ユーザが「文体の再現の強さ」をスライダー等で調整できる
  - 強：かなり寄せる / 弱：標準的で読みやすい文体

---

### 6.5 設定・プライバシー

- データ削除（アカウント削除/日記削除）を提供
- 生成のために参照するデータ範囲の設定（任意）
- 未来日記自動生成をオフにできる（任意：ユーザが自分で書きたい日向け）

---

## 7. 非機能要件

### 7.1 品質

- 生成内容が「不自然に他人っぽい」「急に敬語が変わる」などの違和感を最小化
- ユーザの過去の固有表現やプライベート情報を、不要に過剰露出しない（安全側に丸める）

### 7.2 パフォーマンス

- 当日初回オープン時、体感待ち時間を最小化
  - 例：ローディングUI、生成が遅い場合は暫定短文→追記生成など段階生成（任意）

### 7.3 信頼性

- 生成失敗時：空欄にせず「短い下書き」または「生成できなかった」状態でも編集できる
- オフライン時：最後に保存された下書き/確定版は閲覧可能（要件は段階導入）

### 7.4 セキュリティ / プライバシー

- 通信の暗号化、保存データの暗号化
- ログに本文を不用意に出さない（PII・機微情報対策）
- モデル改善に利用する場合は明示的な同意と、匿名化/最小化を前提

### 7.5 アクセシビリティ

- フォントサイズ変更、ダークモード、スクリーンリーダー対応（優先度は段階的）

---

## 8. 生成ロジック要件（実装に依存しない仕様）

### 8.1 参照（Retrieval）

- 当日生成時に、ユーザの過去の書記から関連度の高い断片を取得する
  - 例：曜日が近い、季節が近い、最近頻出テーマ、直近N件、感情傾向など

### 8.2 生成（Generation）

- 取得した断片をもとに、その日の未来日記を生成する
- 生成テキストは以下の制約を守る：
  - 外部事実の断定を避ける
  - 誹謗中傷・差別表現・自傷他害を助長する表現を避ける
  - 医療/法律/投資など高リスク助言を日記本文として断定的に書かない

### 8.3 ガードレール（推奨）

- ネガティブ反すうを過度に増幅しない
  - 同一の悲観文の連鎖を抑え、事実/感情/次の一手を分離する文体へ誘導（押し付けない）
- ユーザが編集で“現実”に寄せられる前提で、余白を残す

---

## 9. データモデル（例）

- `User`
  - id, timezone, preferences(文体強度, 自動生成ON/OFF, 参照範囲)
- `DiaryEntry`
  - id, user_id, date(YYYY-MM-DD), status(draft/confirmed)
  - generated_text（未来日記ドラフト）
  - final_text（確定本文）
  - created_at, updated_at
- `DiaryRevision`（任意）
  - entry_id, revision_id, text, source(generated/user), timestamp
- `StyleProfile`（任意）
  - user_id, stats(語尾傾向, 句読点頻度, 絵文字頻度 等), updated_at
- `EmbeddingIndex`（任意）
  - user_id, chunk_id, embedding, metadata(date, tags)

---

## 10. 画面/UX要件（最小）

### 10.1 当日ページ

- 画面上部に日付
- 本文エリアに未来日記（下書き）が自動挿入されている
- 「これは下書きです。自由に編集して今日の記録にできます」等の説明（短文）

### 10.2 編集

- 通常のテキスト編集（改行、コピペ、Undo）
- 保存状態が分かる（保存済み/保存中）

### 10.3 履歴

- カレンダー or リストで日記を閲覧

---

## 11. 受け入れ基準（Acceptance Criteria）

1. ユーザが当日初めて当日ページを開くと、未来日記が自動生成され表示される
2. 同日に再度開いても、明示的な再生成がない限り同じ未来日記が表示される
3. 未来日記はユーザの過去の書記を参照し、文体の癖（語尾・改行・語彙）に一定の再現性がある
4. ユーザは未来日記を自由に編集でき、編集内容は保存される
5. 生成に失敗しても、ユーザが日記を入力・保存できる状態は維持される
6. 過去の日記を日付から閲覧できる

---

## 12. 計測（KPI例）

- 日次アクティブユーザ（DAU）
- 当日ページ初回オープン率
- 生成後の編集率（未来日記→確定）
- 1日あたりの平均文字数（生成含む/ユーザ入力のみの両方）
- 継続率（7日/30日）
- ユーザ満足度（簡易アンケート：下書きの“自分っぽさ”、役立ち度）

---

## 13. リスクと対策（初期想定）

- リスク：未来日記が断定的に書かれ、ユーザが違和感/不快感を持つ
  - 対策：下書きラベル、断定回避、再生成/調整、短めにする
- リスク：過去の機微情報を不用意に再提示する
  - 対策：再掲の抑制、ユーザが参照範囲を制御、ログ最小化
- リスク：ネガティブ反すうを強める
  - 対策：ガードレール、自己批判を煽らない文体、任意のやさしいリフレーム提案

---

## 14. 将来拡張（任意）

- 「未来日記」と「実際」の差分から、ユーザの習慣・価値観の変化を可視化
- 気分トラッキング、睡眠・運動などの軽い記録（ただし外部連携は慎重に）
- 週次/月次の振り返り生成（ユーザの言葉でまとめる）
- 未来日記の生成を「今日こうしたい（願望）」モードにも切り替え可能（実行意図/目標設定の支援）

---
